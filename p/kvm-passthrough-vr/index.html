<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="KVM passthough and bridge networks FTW!"><title>I made a virtual machine for VR games.</title>
<link rel=canonical href=https://haiiro.moe/p/kvm-passthrough-vr/><link rel=stylesheet href=/scss/style.min.65329347589b5ea75d6d3a2338dc8b65ddbd0e2d8fc835ecd82105e6d1655e7a.css><meta property='og:title' content="I made a virtual machine for VR games."><meta property='og:description' content="KVM passthough and bridge networks FTW!"><meta property='og:url' content='https://haiiro.moe/p/kvm-passthrough-vr/'><meta property='og:site_name' content='Haiiro'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='kvm'><meta property='article:tag' content='qemu'><meta property='article:tag' content='networking'><meta property='article:published_time' content='2024-02-09T10:45:00+01:00'><meta property='article:modified_time' content='2024-02-09T10:45:00+01:00'><meta name=twitter:site content="@cakeswastaken"><meta name=twitter:creator content="@cakeswastaken"><meta name=twitter:title content="I made a virtual machine for VR games."><meta name=twitter:description content="KVM passthough and bridge networks FTW!"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=https://cakes-api.netlify.app/avatar width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>👾</span></figure><div class=site-meta><h1 class=site-name><a href=/>Haiiro</a></h1><h2 class=site-description>A small blog for a decent sized person.</h2></div></header><ol class=menu-social><li><a href=https://github.com/Kex1016/haiiro-v2 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/cakeswastaken target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/my-links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>My Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#but-why>But why?</a></li><li><a href=#the-guide>The guide.</a><ol><li><a href=#setting-up-your-bios-and-grub>Setting up your BIOS and GRUB</a></li><li><a href=#installing-and-setting-up-packages>Installing and setting up packages</a></li><li><a href=#setting-up-the-guest-os>Setting up the guest OS</a></li><li><a href=#attaching-your-devices>Attaching your devices</a></li><li><a href=#making-the-hooks>Making the hooks</a><ol><li><a href=#libvirt-hook>Libvirt hook</a></li><li><a href=#the-start-hook>The start hook</a></li><li><a href=#the-release-hook>The release hook</a></li><li><a href=#testing-the-scripts>Testing the scripts</a></li></ol></li><li><a href=#audio-passthrough>Audio passthrough</a></li><li><a href=#virtualization-detection>Virtualization detection</a></li><li><a href=#getting-the-gpu-vbios>Getting the GPU vBIOS</a></li><li><a href=#giving-the-vbios-to-your-vm>Giving the vBIOS to your VM</a></li><li><a href=#the-bridge-network>The bridge network</a><ol><li><a href=#using-plasmas-system-settings>Using Plasma&rsquo;s System Settings</a></li><li><a href=#using-nmtui>Using <code>nmtui</code></a></li><li><a href=#the-result>The result</a></li><li><a href=#setting-the-vms-network>Setting the VM&rsquo;s network</a></li></ol></li><li><a href=#thats-it>That&rsquo;s it!</a></li></ol></li><li><a href=#sources>Sources</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/guides/ style=background-color:#b700b7;color:#fff>guides</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/kvm-passthrough-vr/>I made a virtual machine for VR games.</a></h2><h3 class=article-subtitle>KVM passthough and bridge networks FTW!</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 09, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><h1 id=hello-again><a href=#hello-again>#</a>
Hello again!</h1><p>As the title suggests, I come to you with a small guide to get you started with making your own VM!
It is by no means a complete guide, as it will only cover what I personally had to go through to make
things work, but it should be enough for those that have similar specs for their PC.</p><h2 id=but-why><a href=#but-why>#</a>
But why?</h2><p>A while ago I found out that one of the VR games I own got a major update that looked really promising.
Problem was, I am running Linux, and it was not working with <a class=link href=https://github.com/alvr-org/ALVR target=_blank rel=noopener>ALVR</a> and Proton&mldr;
So, after a relatively long procrastination, I decided to just go for making a VM. Here comes problem number two:
Steam Link! Since I have a Quest 2, I cannot just plug and play, I have to connect somewhere, and a regular VM
with the default network just won&rsquo;t do. The Steam app will not detect it! This is where the bridge networks came
in clutch.</p><p><strong>In short:</strong> I care about my privacy, and I was lazy to dualboot.</p><p>Anyways, let&rsquo;s get going!</p><h2 id=the-guide><a href=#the-guide>#</a>
The guide.</h2><p>Like I said at the beginning, this will only cover parts that I personally had to do. <strong>This means there will be
no mention for NVIDIA!</strong> The process is roughly the same, except you will have to <a class=link href="https://github.com/QaidVoid/Complete-Single-GPU-Passthrough?tab=readme-ov-file#vbios-patching" target=_blank rel=noopener>patch your GPU vBIOS</a>.</p><h3 id=setting-up-your-bios-and-grub><a href=#setting-up-your-bios-and-grub>#</a>
Setting up your BIOS and GRUB</h3><p>First thing on our list is to enable all the virtualization tools. Which means, you have to enable <code>Intel VT-d</code> or <code>AMD-Vi</code> in your BIOS. <em>If you don&rsquo;t see these options, your computer likely doesn&rsquo;t support virtualization, making the rest of the steps irrelevant.</em></p><p>Then, we&rsquo;ll need to enable IOMMU. To do that, you&rsquo;ll need to edit <code>/etc/default/grub</code> like so:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=nv>GRUB_CMDLINE_LINUX_DEFAULT</span><span class=o>=</span><span class=s1>&#39;... amd_iommu=on iommu=pt ...&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>For Intel CPUs, type <code>intel_iommu</code> instead of <code>amd_iommu</code></p></blockquote><p>And now restart your computer. To check if things worked, use the <code>dmesg | grep IOMMU</code> commands (as root). You should see something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[    0.324086] pci 0000:00:00.2: AMD-Vi: IOMMU performance counters supported
</span></span><span class=line><span class=cl>[    0.381785] perf/amd_iommu: Detected AMD IOMMU #0 (2 banks, 4 counters/bank).
</span></span></code></pre></td></tr></table></div></div><h3 id=installing-and-setting-up-packages><a href=#installing-and-setting-up-packages>#</a>
Installing and setting up packages</h3><p>Great, you have virtualization enabled, and all your internals are ready to go. Time to set up your packages. I use Arch (btw), but the process is very similar on most systems, provided you don&rsquo;t use something like SELinux, which I will not cover in this guide.</p><details><summary><b>Arch Linux</b></summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S qemu libvirt edk2-ovmf virt-manager dnsmasq ebtables
</span></span></code></pre></td></tr></table></div></div></details><details><summary><b>Fedora</b></summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>dnf install @virtualization
</span></span></code></pre></td></tr></table></div></div></details><details><summary><b>Ubuntu</b></summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>apt install qemu-kvm qemu-utils libvirt-daemon-system libvirt-clients bridge-utils virt-manager ovmf
</span></span></code></pre></td></tr></table></div></div></details><p>After installing these packages, you have to enable some services:</p><details><summary><b>systemd</b></summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>systemctl <span class=nb>enable</span> --now libvirtd
</span></span></code></pre></td></tr></table></div></div></details><details><summary><b>OpenRC</b></summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>rc-update add libvirtd default
</span></span><span class=line><span class=cl>rc-service libvirtd start
</span></span></code></pre></td></tr></table></div></div></details><p>You might need to force start your virtual network as well, you can do that by typing</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo virsh net-start default
</span></span><span class=line><span class=cl>sudo virsh net-autostart default
</span></span></code></pre></td></tr></table></div></div><h3 id=setting-up-the-guest-os><a href=#setting-up-the-guest-os>#</a>
Setting up the guest OS</h3><p>We&rsquo;re getting closer, it&rsquo;s time to install Windows. Get yourself a Windows ISO. Your first step is to make a new virtual machine using Virtual Machine Manager. Make sure to check &ldquo;Customize configuration before install!&rdquo; This is very important!</p><p>In the <em>Overview</em> section, set the VM&rsquo;s chipset to Q35 (likely already the default), and the firmware to UEFI.</p><p>Then, go to the <em>CPUs</em> section and set the configuration to host-passthrough (once again, this is likely the default), and set the topology to your liking. I set it to 1 socket, 5 cores and 2 threads for example.</p><p>Go to the <em>SATA Disk 1</em> section, and set it to <code>Virtio</code>. It will change to &ldquo;Virtio Disk 1&rdquo;. <strong>Do the same with your <em>NIC</em>!</strong></p><p>Download the <a class=link href=https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso target=_blank rel=noopener>virtio-win</a> ISO, and attach it as a CDROM device (Add Hardware > Storage > Device Type).</p><p>You can now hit &ldquo;Begin Installation&rdquo;! Go through the steps just like a normal Windows installation.</p><h3 id=attaching-your-devices><a href=#attaching-your-devices>#</a>
Attaching your devices</h3><p>After the Windows install is done, delete the <code>Sound ich*</code> and <code>Channel (spice)</code> devices, we will not need these anymore. Inside the <em>Display Spice</em> section, change the type to VNC server, and set the address to &ldquo;All interfaces&rdquo;. We will use this to connect to our VM to install the graphics drivers.</p><p>Add your GPU and the HDMI Audio PCI devices (Add Hardware > PCI Host Device). You can also add your USB host devices, we will not need them on the host anyways. Add your keyboard and mouse along with any other device you might need. I added my Bluetooth dongle for example. Your list should look something like this:</p><p><img src=/p/kvm-passthrough-vr/img/09_114922.png width=184 height=637 srcset="/p/kvm-passthrough-vr/img/09_114922_huaccc3e8d2b4d1917083e74c870ecacc3_41203_480x0_resize_box_3.png 480w, /p/kvm-passthrough-vr/img/09_114922_huaccc3e8d2b4d1917083e74c870ecacc3_41203_1024x0_resize_box_3.png 1024w" loading=lazy alt="The VM&rsquo;s devices" class=gallery-image data-flex-grow=28 data-flex-basis=69px></p><h3 id=making-the-hooks><a href=#making-the-hooks>#</a>
Making the hooks</h3><p>The fun part! To use our GPU for this VM, we have to unload everything that uses the GPU, along with the drivers.</p><h4 id=libvirt-hook><a href=#libvirt-hook>#</a>
Libvirt hook</h4><p>This is needed for libvirt to recognize our other hooks.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo mkdir /etc/libvirt/hooks
</span></span><span class=line><span class=cl>sudo touch /etc/libvirt/hooks/qemu
</span></span><span class=line><span class=cl>sudo chmod +x /etc/libvirt/hooks/qemu
</span></span></code></pre></td></tr></table></div></div><p>The contents of <code>/etc/libvirt/hooks/qemu</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>GUEST_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>HOOK_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>STATE_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$3</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MISC</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=p>@:</span><span class=nv>4</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>BASEDIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=nv>$0</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>HOOKPATH</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$BASEDIR</span><span class=s2>/qemu.d/</span><span class=nv>$GUEST_NAME</span><span class=s2>/</span><span class=nv>$HOOK_NAME</span><span class=s2>/</span><span class=nv>$STATE_NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -e <span class=c1># If a script exits with an error, we should as well.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -f <span class=s2>&#34;</span><span class=nv>$HOOKPATH</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=nb>eval</span> <span class=se>\&#34;</span><span class=s2>&#34;</span><span class=nv>$HOOKPATH</span><span class=s2>&#34;</span><span class=se>\&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=o>[</span> -d <span class=s2>&#34;</span><span class=nv>$HOOKPATH</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nb>read</span> file<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>eval</span> <span class=se>\&#34;</span><span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span><span class=se>\&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span> <span class=o>&lt;&lt;&lt;</span> <span class=s2>&#34;</span><span class=k>$(</span>find -L <span class=s2>&#34;</span><span class=nv>$HOOKPATH</span><span class=s2>&#34;</span> -maxdepth <span class=m>1</span> -type f -executable -print<span class=p>;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=the-start-hook><a href=#the-start-hook>#</a>
The start hook</h4><p>This is the script that gets executed when you start the VM. <strong>Make sure to replace <code>win10</code> with your own VM&rsquo;s name!</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo mkdir --parents /etc/libvirt/hooks/qemu.d/win10/prepare/begin
</span></span><span class=line><span class=cl>sudo touch /etc/libvirt/hooks/qemu.d/win10/prepare/begin/start.sh
</span></span><span class=line><span class=cl>sudo chmod +x /etc/libvirt/hooks/qemu.d/win10/prepare/begin/start.sh
</span></span></code></pre></td></tr></table></div></div><p>The contents of <code>/etc/libvirt/hooks/qemu.d/win10/prepare/begin/start.sh</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>set</span> -x
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Stop KDE Plasma</span>
</span></span><span class=line><span class=cl><span class=c1># Comment this out if you&#39;re not using Plasma!</span>
</span></span><span class=line><span class=cl>systemctl --user -M michiru@ stop plasma*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Stop display manager</span>
</span></span><span class=line><span class=cl>systemctl stop display-manager
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Unbind VTconsoles: might not be needed</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>0</span> &gt; /sys/class/vtconsole/vtcon0/bind
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>0</span> &gt; /sys/class/vtconsole/vtcon1/bind
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Unbind EFI Framebuffer</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> efi-framebuffer.0 &gt; /sys/bus/platform/drivers/efi-framebuffer/unbind
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Unload AMD kernel module</span>
</span></span><span class=line><span class=cl>modprobe -r amdgpu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Detach GPU devices from host</span>
</span></span><span class=line><span class=cl><span class=c1># Use your GPU and HDMI Audio PCI host device</span>
</span></span><span class=line><span class=cl><span class=c1># You can check their addresses in virt-manager!</span>
</span></span><span class=line><span class=cl>virsh nodedev-detach pci_0000_03_00_0
</span></span><span class=line><span class=cl>virsh nodedev-detach pci_0000_03_00_1
</span></span><span class=line><span class=cl>virsh nodedev-detach pci_0000_0b_00_6 <span class=c1># My audio controller</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Load vfio module</span>
</span></span><span class=line><span class=cl>modprobe vfio-pci
</span></span></code></pre></td></tr></table></div></div><h4 id=the-release-hook><a href=#the-release-hook>#</a>
The release hook</h4><p>This is the script that gets executed when you stop the VM. <strong>Make sure to replace <code>win10</code> with your own VM&rsquo;s name!</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo mkdir --parents /etc/libvirt/hooks/qemu.d/win10/release/end
</span></span><span class=line><span class=cl>sudo touch /etc/libvirt/hooks/qemu.d/win10/release/end/stop.sh
</span></span><span class=line><span class=cl>sudo chmod +x /etc/libvirt/hooks/qemu.d/win10/release/end/stop.sh
</span></span></code></pre></td></tr></table></div></div><p>The contents of <code>/etc/libvirt/hooks/qemu.d/win10/release/end/stop.sh</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>set</span> -x
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Reattach GPU devices to host</span>
</span></span><span class=line><span class=cl><span class=c1># Use your GPU and HDMI Audio PCI host device</span>
</span></span><span class=line><span class=cl><span class=c1># You can check their addresses in virt-manager!</span>
</span></span><span class=line><span class=cl>virsh nodedev-reattach pci_0000_03_00_0
</span></span><span class=line><span class=cl>virsh nodedev-reattach pci_0000_03_00_1
</span></span><span class=line><span class=cl>virsh nodedev-reattach pci_0000_0b_00_6 <span class=c1># My audio controller</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Unload vfio module</span>
</span></span><span class=line><span class=cl>modprobe -r vfio-pci
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Load AMD kernel module</span>
</span></span><span class=line><span class=cl>modprobe amdgpu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Rebind framebuffer to host</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;efi-framebuffer.0&#34;</span> &gt; /sys/bus/platform/drivers/efi-framebuffer/bind
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bind VTconsoles: might not be needed</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> &gt; /sys/class/vtconsole/vtcon0/bind
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> &gt; /sys/class/vtconsole/vtcon1/bind
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Restart Display Manager</span>
</span></span><span class=line><span class=cl>systemctl start display-manager
</span></span></code></pre></td></tr></table></div></div><h4 id=testing-the-scripts><a href=#testing-the-scripts>#</a>
Testing the scripts</h4><p>This is an optional step, but if these scripts don&rsquo;t work you&rsquo;ll either be stuck on a black screen until you reboot or your VM just won&rsquo;t boot. Here&rsquo;s how you test them:</p><ul><li>Enable SSH (<code>systemctl enable --now sshd</code>)</li><li>Get a second computer and connect to your host<ul><li>To get your host computer&rsquo;s IP, you can do <code>ip a</code></li></ul></li><li><code>ssh username@youripaddress</code></li><li>Execute the start/stop scripts<ul><li><code>sudo /etc/libvirt/hooks/qemu.d/win10/release/end/stop.sh</code></li><li><code>sudo /etc/libvirt/hooks/qemu.d/win10/prepare/begin/start.sh</code></li></ul></li></ul><h3 id=audio-passthrough><a href=#audio-passthrough>#</a>
Audio passthrough</h3><p>Since we&rsquo;re not going to need the host computer&rsquo;s audio, we can just pass the PCI device through. Search for something like &ldquo;HD Audio Controller&rdquo;, or if you have a dedicated card for it, add that one. You could also use <a class=link href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Passing_audio_from_virtual_machine_to_host_via_Scream target=_blank rel=noopener>Scream</a>, or <a class=link href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Passing_audio_from_virtual_machine_to_host_via_PipeWire_directly target=_blank rel=noopener>PipeWire</a>. If you pass it directly, make sure to edit the part marked by &ldquo;My audio controller&rdquo;. Otherwise, comment it out.</p><h3 id=virtualization-detection><a href=#virtualization-detection>#</a>
Virtualization detection</h3><p>For some reason cards don&rsquo;t like it whenyou run them in a VM. Here&rsquo;s how you get around this. Inside your VM&rsquo;s settings, go to the <em>Overview</em> section, switch to the XML tab, and edit the VM like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=nt>&lt;features&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;hyperv&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    <span class=nt>&lt;vendor_id</span> <span class=na>state=</span><span class=s>&#39;on&#39;</span> <span class=na>value=</span><span class=s>&#39;anything&#39;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/hyperv&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;kvm&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;hidden</span> <span class=na>state=</span><span class=s>&#39;on&#39;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/kvm&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/features&gt;</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p><em>Hiding the KVM CPU isn&rsquo;t necessary on AMD, but I added it just to be sure.</em></p><h3 id=getting-the-gpu-vbios><a href=#getting-the-gpu-vbios>#</a>
Getting the GPU vBIOS</h3><p>You could just dump it yourself if you know how to, but there are simpler ways, like <a class=link href=https://www.techpowerup.com/vgabios target=_blank rel=noopener>just downloading the one you need for your card&mldr;</a></p><blockquote><p>Make sure to get your card&rsquo;s ROM! Check the brand, the vendor and the model!!</p></blockquote><p>After you got the vBIOS, name it something simple like <code>gpu.rom</code>, and move it to a folder where libvirt can see it. I did this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo mkdir --parents /var/lib/libvirt/vbios
</span></span><span class=line><span class=cl>sudo mv /path/to/gpu.rom /var/lib/libvirt/vbios
</span></span><span class=line><span class=cl>sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> -R /var/lib/libvirt/vbios
</span></span><span class=line><span class=cl>sudo chmod <span class=m>777</span> -R /var/lib/libvirt/vbios
</span></span></code></pre></td></tr></table></div></div><p>I got a strange error saying it can&rsquo;t find the <code>gpu.rom</code> file when it had rwx permissions for everything, so I gave rwx permissions to everything in the folder, alongside the folder itself.</p><h3 id=giving-the-vbios-to-your-vm><a href=#giving-the-vbios-to-your-vm>#</a>
Giving the vBIOS to your VM</h3><p>In your VM settings, go to your GPU&rsquo;s sections, the XML tab, and add this section to each one (the GPU and the HDMI audio controller):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;hostdev</span> <span class=na>mode=</span><span class=s>&#34;subsystem&#34;</span> <span class=na>type=</span><span class=s>&#34;pci&#34;</span> <span class=na>managed=</span><span class=s>&#34;yes&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;rom</span> <span class=na>file=</span><span class=s>&#34;/var/lib/libvirt/vbios/gpu.rom&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/hostdev&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Of course, change the path in <code>file="..."</code> to your path.</p><h3 id=the-bridge-network><a href=#the-bridge-network>#</a>
The bridge network</h3><p>Here&rsquo;s the part I needed to fix Steam Link not working. We need the VM to be on the same network, so we&rsquo;ll need to make a bridge network. You will need NetworkManager for this.</p><h4 id=using-plasmas-system-settings><a href=#using-plasmas-system-settings>#</a>
Using Plasma&rsquo;s System Settings</h4><p>Inside System Settings, go to the Network category and then Connections. Click on the <code>+</code> sign to add a new connection, and select Bridge under the &ldquo;Virtual connections&rdquo; category. You can name the connection anything you want. <strong>Give a name to the interface, this will be used for the VM.</strong> You will have to add an Ethernet connection to the bridged connections. After you added it, hit save. Now, delete your original Wired Ethernet connection. You won&rsquo;t need this anymore, as the bridge connection will handle everything.</p><p><strong>Do not worry if you don&rsquo;t have internet for a while after setting this up. If you did it right, it should take a while, but the new connection will set itself up again.</strong></p><h4 id=using-nmtui><a href=#using-nmtui>#</a>
Using <code>nmtui</code></h4><p>The process is the same, except it&rsquo;s in the terminal using NetworkManager&rsquo;s built-in TUI tool. The notable difference is in the main menu. To add a connection, you have to go into the &ldquo;Edit a connection&rdquo; menu. There are no categories, you just have to select &ldquo;Bridge&rdquo;.</p><h4 id=the-result><a href=#the-result>#</a>
The result</h4><p><img src=/p/kvm-passthrough-vr/img/09_131637.png width=845 height=845 srcset="/p/kvm-passthrough-vr/img/09_131637_hudc034663fcfc0933734d4de5fa2eb834_47472_480x0_resize_box_3.png 480w, /p/kvm-passthrough-vr/img/09_131637_hudc034663fcfc0933734d4de5fa2eb834_47472_1024x0_resize_box_3.png 1024w" loading=lazy alt="The final result in Plasma&rsquo;s System Settings" class=gallery-image data-flex-grow=100 data-flex-basis=240px></p><h4 id=setting-the-vms-network><a href=#setting-the-vms-network>#</a>
Setting the VM&rsquo;s network</h4><p>Going back to our VM, go to the <em>NIC</em> section, and change the Network source to &ldquo;Bridge device&mldr;&rdquo;. The device name should be automatically filled in, but if it&rsquo;s not, just put in the name you gave to your interface.</p><h3 id=thats-it><a href=#thats-it>#</a>
That&rsquo;s it!</h3><p>You&rsquo;re done! If any issues arise, comment them and I&rsquo;ll do my best to resolve them and edit the post accordingly. Have fun with your new VM!</p><h2 id=sources><a href=#sources>#</a>
Sources</h2><blockquote><p><a class=link href=https://www.techpowerup.com/vgabios target=_blank rel=noopener>TechPowerUp VGA BIOS collection</a></p></blockquote><p><strong>GitHub/Gitlab</strong></p><blockquote><p><a class=link href=https://github.com/QaidVoid/Complete-Single-GPU-Passthrough target=_blank rel=noopener>QaidVoid/Complete-Single-GPU-Passthrough</a></p><p><a class=link href=https://github.com/martinopiaggi/Single-GPU-Passthrough-for-Dummies target=_blank rel=noopener>martinopiaggi/Single-GPU-Passthrough-for-Dummies</a></p><p><a class=link href=https://gitlab.com/risingprismtv/single-gpu-passthrough/-/wikis/home target=_blank rel=noopener>risingprismtv/single-gpu-passthrough</a></p></blockquote><p><strong>YouTube</strong></p><blockquote><p><a class=link href="https://www.youtube.com/watch?v=53ZO2pKS4i0" target=_blank rel=noopener>Coodos - Windows 11 KVM Single GPU Passthrough</a></p><p><a class=link href="https://www.youtube.com/watch?v=DYpaX4BnNlg" target=_blank rel=noopener>Abstract programmer - qemu/kvm bridge and NAT networking</a></p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/kvm/>Kvm</a>
<a href=/tags/qemu/>Qemu</a>
<a href=/tags/networking/>Networking</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//haiiro-moe.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 Haiiro</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.haiiro.moe/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><script>const css=(e,...t)=>{let n="";return e.forEach((e,s)=>{n+=e+(t[s]||"")}),n};(function(){const e=document.querySelector(".site-avatar"),o=e.querySelector("img");if(o.addEventListener("load",()=>{e.classList.add("loaded")}),window.location.pathname!=="/")return;const t=document.createElement("header");t.innerHTML=`
            <div class="container">
                <div class="logo">
                    <div class="en">Haiiro</div>
                    <div class="jp">灰色</div>
                </div>
                <div class="text">
                    <div>
                        A small blog for a decent sized person.
                    </div>
                </div>
                <div class="arrow-down"></div>
            </div>
        `;const n=document.createElement("style");n.innerHTML=css`
          main > header {
            color: var(--card-text-color-main);
            height: calc(100vh - var(--main-top-padding));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
          }

          main > header .logo {
            font-size: 10rem;
            font-weight: bold;
            text-align: center;
            line-height: 0;
            margin-bottom: 10rem;
          }

          main > header .logo .jp {
            opacity: 0.3;
            transform: rotate(12deg);
          }

          main > header .text {
            font-size: 2rem;
            text-align: center;
            opacity: 0.5;
          }

          main > header .text a {
            color: var(--card-text-color-main);
          }

          main > header .arrow-down {
            position: absolute;
            bottom: 5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 1rem solid transparent;
            border-right: 1rem solid transparent;
            border-top: 1rem solid var(--card-text-color-main);
            animation: arrow-down 1s infinite;
          }

          @media (max-width: 767px) {
            main > header {
              height: calc(100vh - var(--main-top-padding) - var(--section-separation) - 220px);
            }
          }
        `;const s=document.querySelector("main.main");s.insertBefore(t,s.firstChild),document.head.appendChild(n)})()</script></body></html>